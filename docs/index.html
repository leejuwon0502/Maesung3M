<html>
	<head>
		<title>3M</title>
		<meta charset="utf-8" />
		<script src="./test.js"></script>
		<style>
			* { padding: 0; margin: 0; }
			canvas { background: #eee; display: block; margin: 0 auto; }
		</style>
	</head>
	<body>
		<canvas id="Canvas" width="480" height="320"></canvas>
		<script>
			var canvas = document.getElementById("Canvas");
			var ctx = canvas.getContext("2d");
			canvas.width = document.body.clientWidth;
			canvas.height = document.body.clientHeight;
			//system
			window.addEventListener("keydown", KeyDown);
			window.addEventListener("keyup", KeyUp);
			window.addEventListener("mousemove", OnMouseMove);
			var OnPress = {};
			var PressedKeys = {};
			let KEYCODES = {
				87 : 'w',
				65 : 'a',
				83 : 's',
				68 : 'd'
			}
			function KeyDown(e) {
				code = KEYCODES[e.keyCode];
				if (!code) {return}
				PressedKeys[code] = OnPress[code];
			}
			function KeyUp(e) {
				delete PressedKeys[KEYCODES[e.keyCode]];
			}
			function OnKey(key, func) {
				OnPress[key] = func;
			}
			function OnMouseMove(e) {
				Light.x = e.clientX;
				Light.y = e.clientY;
			}
			OnKey('w', () => {
				Char.y -= Char.MoveSpeed;
			})
			OnKey('a', () => {
				Char.x -= Char.MoveSpeed;
			})
			OnKey('s', () => {
				Char.y += Char.MoveSpeed;
			})
			OnKey('d', () => {
				Char.x += Char.MoveSpeed;
			})
			function Render() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				GameObjectArray.forEach((e) => {
					e.Draw();
				})
			}
			function Update() {
				Render();
				Controll();
				requestAnimationFrame(Update);
			}
			function Controll() {
				for(let key in PressedKeys) {
					PressedKeys[key]();
				}
			}
			function GetDrawFunction(ObjC, drawInfo) {
				if (drawInfo.Type = "arc") {
					return () => {
						ctx.beginPath();
						ctx.arc(ObjC.x, ObjC.y, ObjC.DrawInfo.Radius, 0, Math.PI*2);
						ctx.fillStyle = ObjC.DrawInfo.Color;
						ctx.fill();
						ctx.closePath();
					}
				}
			}
			class GameObject {
				constructor(
					coord = { x : canvas.width/2, y : canvas.height/2},
					drawInfo
					){
					this.x = coord.x;
					this.y = coord.y;
					this.DrawInfo = [];
					for(let key in drawInfo) {
						this.DrawInfo[key] = drawInfo[key];
					}
					this.Draw = GetDrawFunction(this, drawInfo);

					GameObjectArray.push(this);
				}
				Draw() {}
			}
			//init
			var GameObjectArray = [];
			var Char = new GameObject(undefined, {
				Type : "arc",
				Color : "#0095DD",
				Radius : 10
			});
			Char.Radius = 10;
			Char.MoveSpeed = 5;
			var Light = new GameObject(undefined, {
				Type : "arc",
				Color : "rgba(0, 0, 0, 0.1)",
				Radius : 100
			});
			//code

			//repeat
			Update();
		</script>
	</body>
</html>

