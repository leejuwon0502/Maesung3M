<html>
	<head>
		<title>3M</title>
		<meta charset="utf-8" />
		<script src="./test.js"></script>
		<style>
			* { padding: 0; margin: 0; }
			canvas { background: #eee; display: block; margin: 0 auto; }
		</style>
	</head>
	<body>
		<canvas id="Canvas" width="480" height="320"></canvas>
		<script>
			var canvas = document.getElementById("Canvas");
			var ctx = canvas.getContext("2d");
			canvas.width = document.body.clientWidth;
			canvas.height = document.body.clientHeight;
			var Center = { x : canvas.width / 2, y : canvas.height / 2};
			//system
			window.addEventListener("keydown", KeyDown);
			window.addEventListener("keyup", KeyUp);
			window.addEventListener("mousemove", OnMouseMove);
			var OnPress = {};
			var PressedKeys = [];
			let KEYCODES = {
				87 : 'w',
				65 : 'a',
				//83 : 's',
				68 : 'd'
			}
			function KeyDown(e) {
				code = KEYCODES[e.keyCode];
				if (!code) {return}
				PressedKeys[code] = OnPress[code];
			}
			function KeyUp(e) {
				delete PressedKeys[KEYCODES[e.keyCode]];
			}
			function OnKey(key, func) {
				OnPress[key] = func;
			}
			MousePos = {
				x : 0,
				y : 0
			}
			function OnMouseMove(e) {
				MousePos.x = e.clientX;
				MousePos.y = e.clientY;
			}
			OnKey('w', () => {
				Char.Move(0, -Char.MoveSpeed);
			})
			OnKey('a', () => {
				Char.Move(-Char.MoveSpeed, 0);
			})
			OnKey('d', () => {
				Char.Move(Char.MoveSpeed, 0);
			})
			OnKey('w', () => {
				Jump();
			})
			let ScreenSizeCoef = 50;
			let ScreenSize = { x : 16 * ScreenSizeCoef, y : 9 * ScreenSizeCoef};
			var ClearRectPosition = { x : Center.x - ScreenSize.x / 2, y : Center.y - ScreenSize.y / 2};
			function Render() {
				ctx.clearRect(ClearRectPosition.x, ClearRectPosition.y, ScreenSize.x, ScreenSize.y);
				GameObjectArray.forEach((e) => {
					e.Draw();
				})
			}
			function Update() {
				Controll();
				ChkPhysics();
				ApplyPhysics();
				Render();
				requestAnimationFrame(Update);
			}
			function Controll() {
				for(let key in PressedKeys) {
					console.log(key)
					PressedKeys[key]();
				}
			}

			function SetMoveMethod(ObjC) {
				
			}
			function ChkPhysics() {
				
			}
			function ApplyPhysics() {
				GameObjectArray.forEach((e) => {
					if (!e.isDynamic) {
						return;
					}
					e.Move(e.Velocity.x, e.Velocity.y);
				})
			}
			function GetDrawMethod(ObjC, drawInfo) {
				if (drawInfo.Type = "arc") {
					return () => {
						ctx.beginPath();
						ctx.arc(ObjC.Position.x, ObjC.Position.y, ObjC.DrawInfo.Radius, 0, Math.PI*2);
						ctx.fillStyle = ObjC.DrawInfo.Color;
						ctx.fill();
						ctx.closePath();
					}
				}
			}
			class GameObject {
				constructor(
					positionInfo = { x : Center.x, y : Center.y },
					drawInfo,
					moveSpeed = 0
					){
					this.x = positionInfo.x;
					this.y = positionInfo.y;
					this.Position = {
						x : positionInfo.x,
						y : positionInfo.y
					}
					this.Velocity = {
						x : 0,
						y : 0
					}
					this.DrawInfo = [];
					for(let key in drawInfo) {
						this.DrawInfo[key] = drawInfo[key];
					}
					this.Draw = GetDrawMethod(this, drawInfo);
					if (positionInfo.isDynamic) {
						SetMoveMethod(this);
					}
					this.MoveSpeed = moveSpeed;

					GameObjectArray.push(this);
				}
				Move(x = 0, y = 0) {
					this.Position.x += x;
					this.Position.y += y;
				}
				Draw() {}
				}
			//var, func
			var JumpHeight = 50;
			Jump() {
				if (true) {
					Char.Velocity.y += JumpHeight;
				}
			}
			//init
			ctx.fillRect(0, 0, canvas.width, canvas.height); //화면을 검게 한다
			var GameObjectArray = [];
			var Char = new GameObject(undefined, 
			{
				Type : "arc",
				Color : "#0095DD",
				Radius : 10
			}, 5
			);
			Char.Radius = 10;
			var Light = new GameObject(undefined, {
				Type : "arc",
				Color : "rgba(0, 0, 0, 0.1)",
				Radius : 100
			});
			Light.draw //todo this, movement
			//code
			
			//repeat
			Update();
		</script>
	</body>
</html>

